name: GitHub Actions Build and Deploy
on:
  push:
    branches:

      - master

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:

    - name: 1. git checkout...

      uses: actions/checkout@v1

    - name: 2. setup nodejs...

      uses: actions/setup-node@v1

    - name: 3. install hexo...

      run: |
        npm install hexo-cli -g
        npm install hexo-renderer-less -g
        npm install hexo-generator-feed -g
        npm install hexo-generator-json-content -g
        npm install hexo-helper-qrcode -g
        npm install hexo-generator-baidu-sitemap -g
        npm install hexo-generator-sitemap -g
        npm install
        sudo mkdir -p /root/.ssh/
        sudo echo "${{ secrets.DEPLOY_KEY }}" > /root/.ssh/id_rsa
        sudo chmod 600 /root/.ssh/id_rsa
        ssh-keyscan -t rsa github.com >> /root/.ssh/known_hosts
        git config --global user.email "xltzblog@163.com"
        git config --global user.name "xltzsoft"

    - name: 4. hexo generate public files...

      run: |
        hexo g -d
